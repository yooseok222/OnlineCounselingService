<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.kosa.visang.domain.contractTemplate.repository.ContractTemplateMapper">
    <resultMap id="ContractTemplateResultMap" type="kr.or.kosa.visang.domain.contractTemplate.model.ContractTemplate">
        <id column="contract_template_id" property="contractTemplateId" jdbcType="BIGINT"/>
        <result column="company_id" property="companyId" jdbcType="BIGINT"/>
        <result column="contract_name" property="contractName" jdbcType="VARCHAR"/>
        <result column="descript" property="descript" jdbcType="VARCHAR"/>
        <result column="file_path" property="filePath" jdbcType="VARCHAR"/>
        <result column="version" property="version" jdbcType="VARCHAR"/>
        <result column="created_at" property="createdAt" jdbcType="TIMESTAMP"/>
        <result column="updated_at" property="updatedAt" jdbcType="TIMESTAMP"/>
    </resultMap>

    <select id="getNextTemplateId" resultType="long">
        SELECT CONTRACT_TEMPLATE_SEQ.NEXTVAL FROM dual
    </select>

    <select id="getPathAndHash" resultType="kr.or.kosa.visang.domain.contractTemplate.model.ContractTemplate">
        SELECT file_path AS filePath,
               file_hash AS fileHash
        FROM contract_templates
        WHERE contract_template_id = #{contractTemplateId}
    </select>

    <select id="selectTemplateById" resultMap="ContractTemplateResultMap">
        SELECT contract_template_id, company_id, contract_name, descript, file_path, version, created_at, updated_at
        FROM contract_templates
        WHERE contract_template_id = #{contractTemplateId}
    </select>

    <select id="selectAllContractTemplates" resultMap="ContractTemplateResultMap">
        SELECT contract_template_id, company_id, contract_name, descript, file_path, version, created_at, updated_at
        FROM contract_templates
        WHERE company_id = #{companyId}
        ORDER BY created_at DESC
    </select>

    <insert id="insertTemplate">
        INSERT INTO contract_templates (
        contract_template_id, company_id, contract_name, descript, file_path, version, created_at, updated_at, file_hash
        )
        VALUES (
        #{contractTemplateId}, #{companyId}, #{contractName}, #{descript}, #{filePath}, #{version}, SYSTIMESTAMP, SYSTIMESTAMP, #{fileHash}
        )
    </insert>

    <update id="updateTemplate">
        UPDATE contract_templates
        SET company_id = #{companyId, jdbcType=BIGINT},
            contract_name = #{contractName},
            descript = #{descript},
            file_path = #{filePath},
            version = #{version},
            updated_at = SYSTIMESTAMP
        WHERE contract_template_id = #{contractTemplateId}
    </update>
    <delete id="deleteTemplate" >
        DELETE FROM contract_templates
        WHERE contract_template_id = #{contractTemplateId}
    </delete>

    <select id="findByFileHash" resultMap="ContractTemplateResultMap">
        SELECT contract_template_id, company_id, contract_name, descript, file_path, version, created_at, updated_at
        FROM contract_templates
        WHERE file_hash = #{fileHash}
    </select>
</mapper>