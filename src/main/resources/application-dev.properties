# H2 데이터베이스 설정
spring.datasource.url=jdbc:h2:mem:testdb;MODE=LEGACY;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

# H2 콘솔 활성화
spring.h2.console.enabled=true
spring.h2.console.path=/h2-console
spring.h2.console.settings.web-allow-others=true

# SQL 초기화 설정
spring.sql.init.mode=always
spring.sql.init.schema-locations=classpath:schema.sql
spring.sql.init.data-locations=classpath:data.sql
spring.sql.init.continue-on-error=true
spring.sql.init.platform=h2

# JPA 설정
spring.jpa.hibernate.ddl-auto=none
spring.jpa.defer-datasource-initialization=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.H2Dialect

# MyBatis 설정
mybatis.type-aliases-package=kr.or.kosa.visang.domain.*.model
mybatis.mapper-locations=classpath:mapper/*.xml
mybatis.configuration.map-underscore-to-camel-case=true
mybatis.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl

# Redis 설정
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.timeout=${REDIS_TIMEOUT:3000}

# Mail 설정
spring.mail.host=smtp.gmail.com
spring.mail.port=587
# 이메일 설정 우선순위:
# 1. 환경 변수 GMAIL_USER/GMAIL_PASSWORD가 설정된 경우 해당 값 사용
# 2. 환경 변수가 없는 경우 SpEL을 통해 JasyptUtil을 호출하여 암호화된 값 복호화 시도
# 3. 복호화 실패 시 JasyptUtil 내의 기본 테스트 계정 사용
spring.mail.username=${GMAIL_USER:#{T(kr.or.kosa.visang.common.util.JasyptUtil).getDecryptedValue('ENC(xtXeprUlQkm9wkgotBluILc1Xz95e6IxzbjGgZo7HAkULVajpHvu3rkxSafZlQx4)', '${JASYPT_ENCRYPTOR_PASSWORD:visangisawesome}')}}
spring.mail.password=${GMAIL_PASSWORD:#{T(kr.or.kosa.visang.common.util.JasyptUtil).getDecryptedValue('ENC(73ZGRmsV98W6AGuuOs9eXj5wBv7YRorMvHmY1OHThjCxrSNMNkm0wQ==)', '${JASYPT_ENCRYPTOR_PASSWORD:visangisawesome}')}}
spring.mail.protocol=smtp
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.debug=true
spring.mail.properties.mail.smtp.ssl.trust=smtp.gmail.com

# Thymeleaf 설정
spring.thymeleaf.prefix=classpath:/templates/
spring.thymeleaf.suffix=.html
spring.thymeleaf.mode=HTML
spring.thymeleaf.encoding=UTF-8
spring.thymeleaf.cache=false
spring.thymeleaf.check-template-location=true

# 로깅 설정
logging.level.kr.or.kosa.visang=debug
logging.level.org.springframework.security=debug
logging.level.org.hibernate.SQL=debug
logging.level.org.springframework.jdbc.datasource.init=debug
logging.level.org.springframework.mail=debug
logging.level.org.springframework.web=debug
logging.level.org.mybatis=debug
logging.level.org.thymeleaf=debug

# Jasypt 암호화 설정
jasypt.encryptor.password=${JASYPT_ENCRYPTOR_PASSWORD:visangisawesome} 