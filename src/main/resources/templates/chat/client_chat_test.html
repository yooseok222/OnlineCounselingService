<!DOCTYPE html>
<html>
<head>
	<title>고객 채팅 테스트</title>
	<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
	<h2>채팅방 입장 (고객)</h2>
	<input type="text" id="roomId" placeholder="Contract ID (예: 123)" />
	<button onclick="connect()">입장</button>
	<div id="chat" style="display:none;">
		<h3>채팅방 <span id="roomLabel"></span></h3>
		<div id="messages" style="height:150px; overflow-y:auto; border:1px solid #ccc;"></div>
		<input id="msgInput" placeholder="메시지 입력" />
		<button onclick="send()">보내기</button>
	</div>

	<script>
		let stompClient = null;
		let currentRoomId = null;

		function connect() {
			currentRoomId = document.getElementById('roomId').value;
			document.getElementById('roomLabel').innerText = currentRoomId;
			document.getElementById('chat').style.display = '';

			const socket = new SockJS('/ws');
			stompClient = Stomp.over(socket);
			stompClient.connect({}, () => {
				stompClient.subscribe(`/topic/chat/${currentRoomId}`, msg => {
					const body = JSON.parse(msg.body);
					const div = document.createElement('div');
					div.textContent = `${body.sender}: ${body.content}`;
					document.getElementById('messages').appendChild(div);
				});
			});
		}

		function send() {
			const content = document.getElementById('msgInput').value;
			if (!content) return;
			const message = {
				sender: '고객',
				content: content,
				timestamp: new Date().toISOString()
			};
			stompClient.send(`/app/chat.send/${currentRoomId}`, {}, JSON.stringify(message));
			document.getElementById('msgInput').value = '';
		}
	</script>
</body>
</html>
