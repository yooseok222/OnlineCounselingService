<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<div th:fragment="content">
    <main class="dashboard-content">
        <div class="row">
            <!-- 상담 스케줄 -->
            <div class="col-md-12 mb-4">

                <div id="scheduleSection" class="col-md-12 mb-4">
                    <div class="card h-100">
                        <div class="card-body">

                            <!-- 상단 툴바 (고정) -->
                            <div id="scheduleToolbar"
                                 class="d-flex justify-content-between align-items-center mb-3">
                                <h3 class="card-title">상담 스케줄</h3>
                                <span id="dateRange" class="me-2">2025.05.01 ~ 2025.05.14</span>
                            </div>

                            <!-- FullCalendar 월/주 뷰 컨테이너 -->
                            <div id="calendarContainer">
                                <div id="calendar"></div>
                            </div>

                            <!-- 커스텀 주간 타임테이블 -->
                            <div id="weeklyTimetable" style="display: none;">
                                <table class="table text-center">
                                    <thead>
                                    <tr>
                                        <th>시간</th>
                                        <th>월</th>
                                        <th>화</th>
                                        <th>수</th>
                                        <th>목</th>
                                        <th>금</th>
                                    </tr>
                                    </thead>
                                    <tbody id="timetableBody"></tbody>
                                </table>
                            </div>

                            <!-- 스케줄 추가 모달 -->
                            <div class="modal fade" id="scheduleModal" tabindex="-1">
                                <div class="modal-dialog">
                                    <form id="scheduleForm" class="modal-content">
                                        <input type="hidden" id="clientIdInput" name="clientId">
                                        <input type="hidden" name="agentId" id="agentIdInput" th:value="${agentId}">


                                        <div class="modal-header">
                                            <h5 class="modal-title">스케줄 추가</h5>
                                            <button type="button" class="btn-close"
                                                    data-bs-dismiss="modal"></button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="mb-3">
                                                <label class="form-label">날짜</label>
                                                <input type="date" name="date" class="form-control" required>
                                            </div>

                                            <!-- 시간 선택을 select로 변경 -->
                                            <div class="mb-3">
                                                <label class="form-label">예약 시간</label>
                                                <select name="time" id="reservationTime" class="form-select"
                                                        required></select>
                                            </div>

                                            <!-- 계약서 템플릿 선택 -->
                                            <div class="mb-3">
                                                <input type="hidden" id="companyIdInput" name="companyId" th:value="${companyId}" />
                                                <label for="templateSelect" class="form-label">계약서 템플릿</label>
                                                <select id="templateSelect" name="contractTemplateId" class="form-select">                                                    <option value="">-- 템플릿을 선택하세요 --</option>
                                                    <th:block th:each="tmpl : ${templates}">
                                                        <option th:value="${tmpl.contractTemplateId}"
                                                                th:text="${tmpl.contractName}">템플릿 이름</option>
                                                    </th:block>
                                                </select>
                                            </div>


                                            <!-- 이메일 -->
                                            <div class="mb-3">
                                                <label class="form-label">이메일</label>
                                                <div class="input-group">
                                                    <input type="email" name="email" class="form-control"
                                                           required>
                                                    <button type="button" class="btn btn-outline-secondary"
                                                            id="searchClientBtn">검색
                                                    </button>
                                                </div>
                                                <div id="emailFeedback" class="mt-1"
                                                     style="font-size: 0.9em;"></div>
                                            </div>


                                            <!-- 휴대폰 번호 -->
                                            <div class="mb-3">
                                                <label class="form-label">휴대폰 번호</label> <input type="tel"
                                                                                                name="phone"
                                                                                                class="form-control">
                                            </div>

                                            <div class="mb-3">
                                                <label class="form-label">고객명</label>
                                                <div class="input-group">
                                                    <input type="text" name="clientName" class="form-control"
                                                           required>
                                                </div>
                                            </div>


                                            <!-- 계약 상태 -->
                                            <div class="mb-3">
                                                <label class="form-label">계약 상태</label>
                                                <select name="contractStatus" class="form-select" required>
                                                    <option value="PENDING">예약</option>
                                                    <option value="CANCELLED">취소</option>
                                                </select>
                                            </div>

                                            <!-- 메모 -->
                                            <div class="mb-3">
                                                <label class="form-label">메모</label>
                                                <textarea name="memo" class="form-control" rows="2"></textarea>
                                            </div>

                                            <!-- 초대 코드 -->
                                            <div class="mb-3 invite-code-group" style="display: none;">
                                                <label for="inviteCode" class="form-label">초대코드</label> <input
                                                    type="text" class="form-control" id="inviteCode"
                                                    name="inviteCode" readonly>
                                            </div>


                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-primary" id="saveBtn">추가</button>
                                            <button type="button" class="btn btn-success d-none"
                                                    id="updateBtn">수정
                                            </button>
                                            <button type="button" class="btn btn-secondary"
                                                    data-bs-dismiss="modal">취소
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <!-- 오늘의 계약 -->
            <div class="col-md-12 mb-4">
                <div id="todaySection" class="col-md-12 mb-4">

                    <div class="card h-100">
                        <div class="card-header">
                            <h3 class="card-title">오늘의 계약</h3>
                            <div class="d-flex align-items-center">
                                <button id="prevDayBtn"
                                        class="btn btn-sm btn-outline-secondary me-2">
                                    <i class="bi bi-chevron-left"></i>
                                </button>
                                <span id="todayContractsDate"></span>
                                <button id="nextDayBtn"
                                        class="btn btn-sm btn-outline-secondary ms-2">
                                    <i class="bi bi-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body d-flex flex-column">

                            <div id="todayContractsList" class="mt-3">
                                <ul class="list-group"></ul>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <!-- 나의 계약 현황 -->
            <div class="col-md-12 mb-4">
                <div id="statusSection" class="col-md-12 mb-4">
                    <div class="card h-100">
                        <div class="card-header">
                            <h3 class="card-title">나의 계약 현황</h3>
                        </div>
                        <div class="card-body">
                            <!-- 상태별 카운트 리스트 -->
                            <ul class="status-list d-flex justify-content-around">
                                <li class="status-item text-center" id="count-pending"
                                    onclick="showFilteredContracts('PENDING')">
                                    <div class="status-label">예약된 계약</div>
                                    <div class="status-value">0</div>
                                </li>
                                <li class="status-item text-center" id="count-inprogress"
                                    onclick="showFilteredContracts('IN_PROGRESS')">
                                    <div class="status-label">진행중 계약</div>
                                    <div class="status-value">0</div>
                                </li>
                                <li class="status-item text-center" id="count-completed"
                                    onclick="showFilteredContracts('COMPLETED')">
                                    <div class="status-label">완료된 계약</div>
                                    <div class="status-value">0</div>
                                </li>
                                <li class="status-item text-center" id="count-cancelled"
                                    onclick="showFilteredContracts('CANCELLED')">
                                    <div class="status-label">취소/거절된 계약</div>
                                    <div class="status-value">0</div>
                                </li>
                            </ul>

                            <!-- 상태별 계약 목록 출력 영역 -->
                            <div class="d-flex justify-content-between align-items-center mt-4"
                                 style="margin-bottom: 15px;">
                                <h5 class="mb-2">선택한 상태의 계약 목록</h5>
                                <div class="btn-group" id="sortOrderButtons">
                                    <button class="btn btn-outline-primary btn-sm active"
                                            onclick="setSortOrder('DESC', this)">최신순
                                    </button>
                                    <button class="btn btn-outline-secondary btn-sm"
                                            onclick="setSortOrder('ASC', this)">오래된순
                                    </button>
                                </div>

                            </div>
                            <ul id="filteredContractsList" class="list-group"></ul>
                            <div id="paginationContainer" class="d-flex gap-2 justify-content-center mt-3"></div>

                        </div>

                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<th:block th:fragment="script">
    <!-- FullCalendar -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

    <!-- Swiper / STOMP -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@4.5.0/dist/js/swiper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script th:src="@{/js/agent/agent.js}"></script>
</th:block>
</html>